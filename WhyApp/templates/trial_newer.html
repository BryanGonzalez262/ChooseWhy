<!DOCTYPE html>
<html lang="en">
{% extends "base.html" %}
{% block js %}
<script>
    var response = {}
    var s_dat = {
        subject_id: new URLSearchParams(window.location.search).get('PID'),
        trial: new URLSearchParams(window.location.search).get('TRL'),
        p_c1: {{ p[0] }},
        p_c2: {{ p[1] }},
        p_c3: {{ p[2] }}
    }

    function submitData(){
        $.ajax({
                 type: "POST",
                 url:window.location.pathname,
                 data: JSON.stringify(Object.assign(s_dat, response)),
                 traditional: true,
                 contentType: "application/json; charset=utf-8",
                 dataType: "json",
                 success: function(){window.location.pathname = '/iti'; console.log('data sent from client')}
        })

    }
    var spacepress = 0
    document.addEventListener("keypress",
    function(event){if (event.key === " "){
        spacepress++
        console.log('spacespace')
        if (spacepress === 1){$('#outcome').css('opacity', 1).toggleClass('animated bounceInUp')}
        else if (spacepress === 2){$('#judgement').css('opacity', 1)}

    }})
</script>
{% endblock %}

{% block stage %}
    <div class="row justify-content-center">
        <div class="col-md-1">Progress:</div>
        <div class="col-md-1" style="text-align: right;">0</div>
        <div class="col-md-7"><input type="range" value="{{ trl }}" min=0 max=100" style="width: -webkit-fill-available;" id="progress"></div>
        <div class="col-md-1">100%</div>
        <script>
            var $rs = $('#progress')
            $rs.rangeslider({
                polyfill: true,
                onInit:function(){},
                onSlide: function (){}
            })
        </script>
    </div>
    <div class="row justify-content-between">
        <div class="col-lg-4"><h3>Probabilities</h3></div>
        <div class="col-lg-4"><h3>Outcome</h3></div>
        <div class="col-lg-4"><h3>Judgement</h3></div>
    </div>
    <div class="row justify-content-between">
        <div class="col-lg-2">
            {% for rate in jars %}
                <div class="row align-items-center justify-content-center">
                    <div class="row align-items-center justify-content-center animated bounceInLeft">
                        <p style="text-align: center">Jar {{ rate|string }}</p>
                    </div>
                    <div class="row align-items-center justify-content-center animated bounceInLeft">
                            <img src="../static/stim/t_{{ p[loop.index - 1]|safe }}.png" style="height: 20vh;">
                    </div>
                </div>
                <hr>
        {% endfor %}
        </div>
        <div class="col-lg-3" id="outcome" style="opacity: 0">
            <br>
            <div class="row justify-content-center">
                <img src="../static/stim/winningAgif.gif" style="width: 15vw;">
            </div>
            <hr>
            <br>
            <div class="row justify-content-center"><img src="../static/stim/winningBgif.gif" style="width: 15vw;"></div>
            <hr>
            <br>
            <div class="row justify-content-center"><img src="../static/stim/winningCgif.gif" style="width: 15vw;"></div>
            <hr>

        </div>
        <div class="col-lg-7" id="judgement" style="opacity: 0;">
            {% for rate in jars %}
                <div class="row">
                <div class="row">
                    <div class="col-sm-10 text-right"><p>Drawing a red ball from Jar {{ rate|string }} caused the win.</p></div>
                    <div class="col-sm-2" id="slide_val_{{ rate }}" style="text-align: left;"><h3></h3></div>
                </div>
                <div class="row align-items-center">
                    <div class="col-lg-8" style="opacity: 1;">
                        <div class="row align-items-center">
                            <div class="col-sm-1"><p style="text-align: left; font-size: xx-large;">0</p></div>
                            <div class="col-sm-9"><input type="range" value="50" min=0 max=100" style="width: 26vw;" id="jar{{ rate }}"></div>
                            <div class="col-sm-1"><p style="text-align: left; font-size: xx-large;">100</p></div>
                        </div>
                        <div class="row justify-content-between">
                            <div class="col-sm-5 text-left" style="text-align: left;"><p>Not at all responsible</p></div>
                            <div class="col-sm-5 text-right" style="text-align: right;"><p>Completely responsible</p></div>
                        </div>
                    </div>
                </div>
                </div>
            <hr>
            <script>
                var $rangeslider = $('#jar{{ rate }}')
                response.q_{{ loop.index }} = []
                $rangeslider.rangeslider({
                    polyfill: false,
                    onInit: function () {},
                    onSlide:function(){$('#slide_val_{{ rate }} h3').text(': '+ String(parseInt(this.value)))},
                    onSlideEnd: function () {
                        response.q_{{ loop.index }}.push(parseInt(this.value));
                        if (Object.values(response).every(a => a.length >= 1)){$('#cont_butt').removeClass("disabled")}

                    }
                })
            </script>
            {% endfor %}
        </div>
    </div>
    <div class="row justify-content-center">
        <p style="text-align: center; font-size: large;">Press the space bar to continue</p>
    </div>

{% endblock %}

</html>